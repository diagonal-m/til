# URIの仕様

## URIの重要性

- URIはUniform Resource Identifierの略で、直訳すると「統一リソース識別子」となる

  → リソースを統一的に識別するIDのこと

  → URIを使うとWeb上に存在するすべのリソースを一意に示すことができる

## URIの構文

- URIの仕様はRFC3986である

### 簡単なURIの例

```
http://blog.example.jp/entries/1
```

このURIを構成するパーツは以下のようになる

1. URIスキーム：http

2. ホスト名：blog.example.jp

3. パス：/entries/1



- URIはURIスキームで始まる
  - URIスキームは、そのURIが利用するプロトコルを示すのが一般的である。
  - ↑の例の場合はリソースにHTTPでアクセスできることを示す
  - URIスキームとその後ろに続く部分は「://」で区切られる
- 次にホスト名が出現する
  - ホスト名はDNS(Domain Name System)で名前が解決できるドメイン名かIPアドレス
  - インターネット上で必ず一意になる
- ホスト名のあとには階層を表すパスが続く
  - パスは、そのホストの中でリソースを一意に指し示す

→ インターネット上で必ず一意になるホスト名のしくみと、ホスト内で必ず一意になる階層的なパスを組み合わせることで、あるリソースのURIが世界中のほかのリソースのURIと絶対に重複しないようになっている。



### 複雑なURIの例

```
http://yohei:pass@blog.example.jp:8000/search?q=test&debug=true#n10
```

このURIは以下のように分けられる

1. URIスキーム：http
2. ユーザ情報：yohei:pass
3. ホスト名：blog.example.jp
4. ポート番号：8000
5. パス：/search
6. クエリパラメータ：q=test&debug=true
7. URIフラグフラグメント：#n10



- URIスキームの次にユーザ情報が入っている
  - ユーザ情報は、このリソースにアクセスする際に利用するユーザ名とパスワードから成る
  - ユーザー名とパスワードは「：」で区切る
- ユーザ情報の次に区切り文字である「@」があり、その後ろにホスト情報が続く
  - ホスト情報はホスト名とポート番号からなり、両者は「:」で区切られる
  - ポート番号は、このホストにアクセスするときのプロトコルで用いるTCPのポート番号を示す
  - ポート番号を省略した場合は各プロトコルのデフォルト値が使われる
    - HTTPのデフォルト値は80番
- パスの後ろに区切り文字である「?」が付き、名前=値形式のクエリが続く
  - ↑では「q=test」と「debug=true」がそれぞれクエリ
  - クエリが複数あるときは「&」で連結する
  - 1つ以上のクエリの集合を「クエリパラメータ」または「クエリ文字列」と呼ぶ
  - クエリパラメータは、たとえば検索サービスに検索キーワードを渡すときなど、クライアントから動的にURI生成するときに利用する
- 最後の「#」で始まる文字列は「URIフラグメント」という
  - URIフラグメントは、その前までの文字列で表現するURIが指し示すリソース内部の、さらに細かい部分を特定するときに利用する。
  - たとえば、このリソースがHTML文書だった場合は、id属性の値が「n10」である要素を示すことになる

## 絶対URIと相対URI

- URIのパスは、UNIXのファイルシステムと同じような階層構造を持っている
  - 「/」をルートとして、ディレクトリ名を「/」で区切り、必要であれば最後にファイル名を接続する記法
  - OSのファイルシステムでは、ルートから記述したパスのことを「絶対パス」と呼ぶ

```
/foo/bar/baz
```

- OSのファイルシステムの場合、毎回絶対パスを書くのは冗長なので、コマンドラインからディレクトリやファイルの位置を指定する場合は、カレントディレクトリからの早退パスで表すのが一般的である。
- OSのファイルシステムと同様に、URIにも絶対URIと相対URIがある
  - 相対URIは、URIスキームやホスト名を省いて、パスだけで表現する
- 以下に絶対URIと相対URIの例を示す

`絶対URI`

```
http://example.jp/foo/bar
```

`相対URI`

```
/foo/bar
```



### ベースURI

- 相対URIは、そのままではクライアントが解釈できない
- 相対URIの起点となるURIがどこなのかがわからないからである
- その起点となるURIを指定するのがベースURIである
- たとえばベースURIがhttp://example.jp/foo/barだとする
- 相対URIを絶対URIに変換するためにはベースURIが必要

### リソースのURIをベースURIとする方法

- 絶対URIが出現するリソースのURIをベースURIにするのは直感的な方法である
  - あるリソースを取得したときに相対URIが登場したら、そのリソースのURIをベースURIとして相対URIを解決する
- この方法は直感的でわかりやすいが、ベースURIとなるリソースのURIをクライアント側で保存しておかなければならないという問題がある

### ベースURIを明示的に指定する方法

- 先の問題を解決する方法の一つが、HTMLやXMLの中で明示的にベースURIを指定する方法である
- HTMLの場合は\<head>要素の中に\<base>要素をいれる



## URIと文字

### URIで使用できる文字

URI仕様では、次の文字がURIのパスに使えると定められている

1. アルファベット：A-Za-z

2. 数字：0-9

3. 記号：-.~:@!$&'()

- この文字列はいわゆるASCII文字である
  - URIには日本語の文字を直接入れられない
- 日本語などのASCII以外の文字をURIに入れるときは%エンコーディングという方式を用いる



### %エンコーディング

- URI仕様が許可している文字以外をURIに入れるには、%エンコーディングでその文字をエンコードする