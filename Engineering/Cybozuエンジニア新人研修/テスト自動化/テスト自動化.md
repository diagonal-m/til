# テスト自動化

## なぜテストを自動化するのか

### 速い・安い・正確

- テスト自動化のメリット
  - 速い
    - 人間がテストを行うよりも早く結果を出せる
  - 安い
    - プログラムで実行するので、人的工数がかからない
  - 正確
    - うっかり、見落としといった人的ミスがなく正確

### 開発プロセスに対する効果

- 開発物に対する素早いフィードバックが可能
  - 問題に対処するための工数を削減できる
    - 記憶を掘り起こす時間
    - 経緯を確認する時間
    - プログラムの内容を把握する時間

→ 短期間で開発を行うAgile開発において素早いフィードバックを行えることはメリット

### 活用例：CI(継続的インテグレーション)

- プログラム変更後、アーカイブビルドとテストを自動的に行う
  - 不具合にいち早く気付くことができる
  - 変更点のマージ時にテストが必ず自動的に行われる
    - 不具合を他人に引き継がない
- レポジトリ内を常に安全な状態に保つ

## E2E(end to end)テストを自動化

### Selenium IDE

- 公式サイト
  - Https://www.selenium.dev/selenium-ide/
- どんなツール？
  - ブラウザで行った操作を記録(Recode)して再現(Replay)する
  - ブラウザのプラグイン
    - FireFox/Chromeに対応
  - 記録した操作をCUIで実行することも可能

## なぜ、自動化したテストを使わないの？

### 自動化したテストを使わなくなる理由

- 動かなくなった
  - 製品の仕様変更により動かなくなった
  - ブラウザのバージョンなどの外部変化により動かなくなった
- メンテナンスできない
  - メンテナンスできる人がいない
- 工数が確保できない
  - メンテナンスの量が多すぎて手が回らない

### 自動化したら、それ以上のコストがかからない？

- テスト内容に変化がなくても、メンテナンスを迫られる
  - 機能や仕様の変化
  - ブラウザ・OSの変化などの外的要因

### 自動化したテストは繰り返さないと意味がない

- テストを自動化するためには多くのコストが必要
- 繰り返し使うことで、そのテストにかかるToCを下げる



> テスト自動化の恩恵を享受するには、自動化したテストを繰り返す長く使う必要がある。
>
> 繰り返し長く使うためには、作成やメンテナンスにかかるコストを下げることを意識した方がよい。

> 「作成・メンテナンスにかかるコストを下げる」
>
> 低コストで試験する

### 作成・メンテナンスのコストが高くなる原因は？

- 初期実装コストが高い

  - 技術的には自動化が可能だが、作成工数が高い

    → 作成工数が高くないテストだけを自動化する

- 仕様変更が多い機能

  - いわゆる「枯れてない」機能

    → 変更が少ないテストだけを自動化する

- 外部仕様の変更

  - OSやブラウザ・ライブラリの変化等

    → 回避できない変化

### メンテナンスの発生を抑えてコストを下げよう

- 変更が少ない”枯れている”機能
  - 重要度の高い機能
  - 繰り返しテストが実行される機能
  - 自動化する難易度が低い機能

> 自動化にかかるコストを削減するにも限界がある。
>
> テスト自体のコストを削減できないか

> 「テストにかかるコストを下げる」
>
> 低コストで試験する

### 開発工程毎のテスト

- 実装前の仕様検討
  - 仕様を検討して、不具合の作り込みを防止する
- Unitテスト(単体テスト)
  - 関数やメソッドなど、最小単位のプログラムに対するテスト
- インテグレーション(結合テスト)
  - 機能に対するUIを用いないテスト
- E2Eテスト(UIテスト)
  - ユーザー操作に最も近い、ブラウザを用いたテスト

### 開発工程とテストにかかるコスト

- 工程が進むにつれて、テストに必要なコストは増加する

### 例) ユーザー名とパスワードの確認

※ユーザー名とパスワードが一致していなければエラーになることを確認

- Unitテスト(単体テスト)
  - 関数にユーザー名とパスワードを渡してエラーになるか確認
- インテグレーション(結合テスト)
  - APIにユーザー名とパスワードを渡してエラーになるか確認
- E2Eテスト(UIテスト)
  - ブラウザから入力してエラーが出ることを確認

### テストに必要な環境

- Unitテスト(単体テスト)
  - 環境作成の必要なし(関数の引数に値を設定)
- インテグレーション(結合テスト)
  - APIが動作する環境を作成
  - ユーザーデータ
- E2Eテスト(UIテスト)
  - APサーバーを用意
  - アーカイブを用意してインストール
  - ユーザーデータ

> テストにかかるコストを削減するために、
>
> 適切なプロセスで適切なテストを行うことが重要

### 「テストピラミッド」という概念

- テスト実行コストが低い層のテストを厚く行うことで全体のコストを抑える戦略
- 効率のよい開発(テスト)を行う上で重要な概念
- Mike Cohn氏が提唱したモデル

### 適切なタイミングでテストを行う

- どの段階のテストも必要なテスト
  - どの段階が悪い、という話ではない
- 各段階のテストの特性を理解することが重要
  - 何を目的としたテストなのか
  - テスト準備・テストにかかる工数の違い